<html data-namespace-typo3-fluid="true"
	  xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
	  xmlns:core="http://typo3.org/ns/TYPO3/CMS/Core/ViewHelpers">

<f:layout name="Simple" />

<f:section name="content">
    <h1>{f:translate(key:'task.header')}</h1>
    <f:if condition="{tasks}">
        <f:then>
            <div class="panel panel-default">
                <div class="panel-heading">
                    {f:translate(key:'task.total', arguments:'{0:\'{tasks -> f:count()}\'}')}
                </div>
                <table class="table table-striped table-hover task-list">
                    <thead>
                        <tr>
                            <th></th>
                            <th>{f:translate(key:'tx_t3monitoring_domain_model_client')}</th>
                            <th>{f:translate(key:'tx_t3monitoring_domain_model_task.table.col.client_task_uid')}</th>
                            <th>{f:translate(key:'tx_t3monitoring_domain_model_task.description')}</th>
                            <th>{f:translate(key:'tx_t3monitoring_domain_model_task.lastexecution')}</th>
                            <th>{f:translate(key:'tx_t3monitoring_domain_model_task.nextexecution')}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <f:for each="{tasks}" as="task">
                            <tr>
                                <td>
                                    <f:if condition="{task.lastexecutionFailure}">
                                        <f:then>
                                            <span data-toggle="tooltip" data-title="{task.lastexecutionFailure}" data-placement="right" class="label label-danger">
                                                <f:translate key="task.error" />
                                            </span>
                                        </f:then>
                                        <f:else>
                                            <span class="label label-success"><f:translate key="task.ok" /></span>
                                        </f:else>
                                    </f:if>
                                </td>
                                <td data-order="{task.client.title -> f:format.htmlspecialchars()}">
                                    <f:link.action action="show" controller="Client" arguments="{client:task.client}">
                                        <f:if condition="{emConfiguration.presentationMode}">
                                            <f:then>
                                                <f:translate key="presentationMode.client.title" arguments="{0:task.client.uid}" />
                                            </f:then>
                                            <f:else>
                                                {task.client.title}
                                            </f:else>
                                        </f:if>
                                    </f:link.action>
                                </td>
                                <td data-order="{task.taskClientUid}">
                                    {task.clientTaskUid}
                                </td>
                                <td data-order="{task.description -> f:format.htmlspecialchars()}">
                                    {task.description}
                                </td>
                                <td data-order="{task.lastexecution}">
                                    <f:format.date format="d.m.Y H:i">{task.lastexecution}</f:format.date> ({task.lastexecutionContext})
                                </td>
                                <td data-order="{task.nextexecution}">
                                    <f:format.date format="d.m.Y H:i">{task.nextexecution}</f:format.date>
                                </td>
                            </tr>
                        </f:for>
                    </tbody>
                </table>
            </div>
        </f:then>
        <f:else>
            <div class="alert alert-notice">
                {f:translate(key:'task.notFound')}
            </div>
        </f:else>
    </f:if>
</f:section>